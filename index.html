<!DOCTYPE html>
<html>
<head>
    <title>Rotating Rods Animation</title>
    <style>
        body { 
            margin: 0px;
        }
        canvas {
            border: 0px solid black;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script>

// Setup canvas
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
ctx.translate(0.5,0.5);
document.addEventListener("keyup",keyup);
window.addEventListener("keydown", function(e) {
    if(["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code) > -1) {
        e.preventDefault();
    }
}, false);

// Adjustable parameters
const params = {
    dim: 2,                   // number of rods
    initLengths: [10,10,10,10,10,10,10], // length of rods
    speeds: [0.1,0.1,0.1,0.1,0.1,0.1,0.1],  // sotation speed rods
    traceLength: 6000,        // points to keep trace
    canvasSize: 800,          // canvas width and height
    pointsPerFrame: 100,      // animation speed
    showRods: false,          // show rods on/off
    showParams: true,         // show params on/off
    runAnim: true,            // animation on/off
    slowAnim: false,          // slower animation
    selectedRod: 0,           // rod to adjust length/speed
    tracePoints: [],
    angles: [0,0,0,0,0,0,0],
    lengths: [10,10,10,10,10,10,10],
};

let paramsIndex=0;
const params2Array = [
            [170, 160, 0.10, 0.01415926535, 6600],
            [170, 160, 0.67, 0.273, 1887],
            [170, 160, 0.9726, 0.0344, 1538],
            [170, 160, 0.075, 0.78, 1200],
            [170, 160, 0.1319, 0.7065, 1441],
            [170, 160, 0.1656, 0.9744, 835],
            [170, 160, 0.4644, 0.7896, 1620],
            [170, 160, 0.0444, 0.6288, 1966],
            [170, 160, 0.8064, 0.9678, 839],
            [170, 160, 0.2356, 0.8373, 770],
            [170, 160, 0.6333, 0.5845, 1220],
            [170, 160, 0.2053, 0.8463, 814],
            [170, 160, 0.7657, 0.7815, 800],
            [170, 160, 0.4189, 0.4611, 1672],
            [170, 160, 0.9502, 0.1238, 1765],
            [170, 160, 0.5607, 0.5619, 1998],
            [170, 160, 0.29639, 0.69145, 1778],
            [133, 97, 0.2949, -0.7938, 3399],
        ];
const params3Array = [
    [100,  75, 0, 0.1000,-0.101,0.0000, 1000],
    [105,  3, 87, 0.6395,0.1470,0.3388, 1000],
    [ 79,100, 20, 0.5249,0.0340,0.4062, 3000],
    [ 57, 98,115, 0.7005,0.9377,0.8191, 5144],
    [ 41,103, 42, 0.1288,0.6725,0.0521, 1162],
    [120,110,100, 0.7192,0.1661,0.0970, 6000],
    [120,110,100, 0.5859,0.3908,0.0970, 4000],
    [120,110,100, 0.9491,0.0943,0.5702, 4000],
    [120,110,100, 0.8430,0.2536,0.4066, 4000],
    [120,110,100, 0.8293,0.3958,0.3557, 4500],
    [120,110,100, 0.0825,0.8394,0.1274, 4888],
    [120,110,100, 0.1869,0.2829,0.0020, 5500],
    [120,110,100, 0.1257,0.2531,0.8203, 5000],
    [120,110,100, 0.7560,0.0587,0.4183, 3629],
    [120,110,100, 0.6715,0.5785,0.7181, 6000],
    [120,110,100, 0.1738,0.8812,0.5799, 5000],
    [120,110,100, 0.0459,0.0303,0.7239, 6000],
    [120,110,100, 0.4906,0.1704,0.9403, 3700],
    [120,110,100, 0.5182,0.2690,0.6720, 6000],
    [120,110,100, 0.3313,0.1815,0.5861, 6000],
    [120,110,100, 0.1373,0.9311,0.0895, 4500],
    [120,110,100, 0.5746,0.0108,0.0098, 5000],
    [130, 48,125, 0.8335,0.4261,0.0948, 2500],
    [145, 98,148, 0.0122,0.5401,0.5035, 4767],
    [ 81,138, 79, 0.3287,0.6423,0.1725, 1981],
    [ 74, 96, 45, 0.2928,0.1673,0.2134, 15000],
    [ 98, 54,119, 0.7532,0.4436,0.0664, 1700],
    [  7, 96,110, 0.8265,0.6391,0.1901, 1200],
    [ 96,136, 34, 0.9652,0.0788,0.1085, 3000],
    [102, 51,138, -0.9348,0.1634,-0.1216, 5153],
];

const paramsArray = [];
params2Array.forEach( row => paramsArray.push( [ 2, [row[0],row[1],0,,0,0,0,0,], [row[2],row[3],0,0,0,0,0], row[4] ] ));
params3Array.forEach( row => paramsArray.push( [ 3, [row[0],row[1],row[2],0,0,0,0,], [row[3],row[4],row[5],0,0,0,0], row[6] ] ));

animate();

// clear screen
function clearScreen() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    params.canvasSize = Math.min(canvas.width, canvas.height)-15;
    centerX = canvas.width / 2;
    centerY = canvas.height / 2 - 10;
    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function keyup(event) {
    // pendulum display
    if (event.key=="P") params.showRods = !params.showRods;
    // values display
    else if (event.key=="V") params.showParams = !params.showParams;
    // turtle speed
    else if (event.key=="T") params.slowAnim = !params.slowAnim;
    // break
    else if (event.key==" ") {
        params.runAnim = !params.runAnim;
        if (params.runAnim) requestAnimationFrame(animate);
    }
    // log
    else if (event.key=="L") {
        let str='['+params.dim+', ';
        for(let i=0;i<params.dim;i++) str+=params.initLengths[i]+", ";
        for(let i=0;i<params.dim;i++) str+=params.speeds[i]+', ';
        str+=params.traceLength+'],';
        console.log(str);
    }
    else if (event.key=="Enter") {
        params.dim=Math.floor(2+6*Math.random());
        for (let i=0;i<params.dim;i++) {
            params.speeds[i]=2*Math.random()-1;
        }
        for (let i=0;i<params.dim;i++) {
            params.initLengths[i]=Math.floor(150*Math.random());
        }
        params.traceLength=Math.floor(6000*Math.random());
    }
    else if (event.key>="a" && event.key<="z") {
        let c = event.key.charCodeAt(0)-97;
        fillParams(paramsArray[c]);
    }
    else if (event.key>="0" && event.key<="9") {
        let c = event.key.charCodeAt(0)-48;
        if (c>=params.dim) c=params.dim-1;
        params.selectedRod=c;
    }
    else if (event.key=="Q") {
        params.initLengths[params.selectedRod] -= 10;
        if (params.initLengths[params.selectedRod]<0) params.initLengths[params.selectedRod]=0;
    }
    else if (event.key=="W") {
        params.initLengths[params.selectedRod] -= 1;
        if (params.initLengths[params.selectedRod]<0) params.initLengths[params.selectedRod]=0;
    }
    else if (event.key=="E") {
        params.initLengths[params.selectedRod] += 1;
        if (params.initLengths[params.selectedRod]>100) params.initLengths[params.selectedRod]=100;
    }
    else if (event.key=="R") {
        params.initLengths[params.selectedRod] += 10;
        if (params.initLengths[params.selectedRod]>100) params.initLengths[params.selectedRod]=100;
    }
    else if (event.key=="A") {
        params.speeds[params.selectedRod] -= 0.0100;
        if (params.speeds[params.selectedRod]<0) params.speeds[params.selectedRod]=0;
    }
    else if (event.key=="S") {
        params.speeds[params.selectedRod] -= 0.0010;
        if (params.speeds[params.selectedRod]<0) params.speeds[params.selectedRod]=0;
    }
    else if (event.key=="D") {
        params.speeds[params.selectedRod] += 0.0010;
        if (params.speeds[params.selectedRod]>100) params.speeds[params.selectedRod]=100;
    }
    else if (event.key=="F") {
        params.speeds[params.selectedRod] += 0.0100;
        if (params.speeds[params.selectedRod]>100) params.speeds[params.selectedRod]=100;
    }
    else if (event.key=="ArrowLeft") {
        paramsIndex = paramsIndex-1;
        if (paramsIndex<0) paramsIndex=paramsArray.length-1;
        fillParams(paramsArray[paramsIndex]);
    }
    else if (event.key=="ArrowRight") {
        paramsIndex = paramsIndex+1;
        if (paramsIndex>=paramsArray.length) paramsIndex=0;
        fillParams(paramsArray[paramsIndex]);
    }
}

function fillParams(p) {
    params.tracePoints=[];
    params.dim=p[0];
    for (let i=0;i<params.dim;i++) {
        params.initLengths[i]=p[1][i];
    }
    for (let i=0;i<params.dim;i++) {
        params.speeds[i]=p[2][i];
    }
    params.traceLength=p[3];
    // reset angles
    for (let i=0;i<params.dim;i++) {
        params.angles[i]=0;
    }
}

function animate() {
    // Clear canvas
    clearScreen();

    var xs=[0,1,2,3,4,5,6],ys=[0,1,2,3,4,5,6],xEnd,yEnd;
    
    // Update rod lengths for canvas size
    let sum = 0; 
    for (let i=0;i<params.dim;i++) sum+=params.initLengths[i];
    for (let i=0;i<params.dim;i++) {
        params.lengths[i]=Math.floor(params.initLengths[i]*params.canvasSize/2/sum);
    }

    for (let i=0; i<(params.slowAnim?1:params.pointsPerFrame); i++) {

        // Calculate rod endpoints
        xs[0] = centerX + Math.cos(params.angles[0]) * params.lengths[0];
        ys[0] = centerY + Math.sin(params.angles[0]) * params.lengths[0];
        for (let i=1; i<params.dim; i++) {
            xs[i] = xs[i-1] + Math.cos(params.angles[i]) * params.lengths[i];
            ys[i] = ys[i-1] + Math.sin(params.angles[i]) * params.lengths[i];
            xEnd=xs[i]; yEnd=ys[i];
        }

        // Add new trace point
        params.tracePoints.push({x: xEnd, y: yEnd});
        while (params.tracePoints.length > params.traceLength && params.tracePoints.length > params.pointsPerFrame) {
            params.tracePoints.shift();
        }

        // Update angles
        for (let i=0;i<params.dim;i++) {
            params.angles[i]+=params.speeds[i];
        }
    }

    // Draw trace
    ctx.beginPath();
    ctx.strokeStyle = 'rgba(200, 0, 0, 0.5)';
    ctx.lineWidth = 1;
    for (let i = 0; i < params.traceLength; i++) if (i<params.tracePoints.length) {
        const point = params.tracePoints[i];
        if (i === 0) {
            ctx.moveTo(point.x, point.y);
        } else {
            ctx.lineTo(point.x, point.y);
        }
    }
    ctx.stroke();

    // Write params
    if (params.showParams) {
        ctx.font="16px Arial";
        let iy=0, dy=20;
        ctx.fillStyle="white";
        ctx.fillText(paramsIndex,10,dy+15*++iy);
        for (let i=0; i<params.dim; i++) {
            ctx.fillStyle=(i==params.selectedRod?"red":"white");
            ctx.fillText(params.initLengths[i]+' '+params.speeds[i],10,dy+15*++iy);
        }
        ctx.fillStyle="white";
        ctx.fillText(params.traceLength,10,dy+15*++iy);
    }

    // Draw rods
    if (params.showRods) {
        ctx.beginPath();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.moveTo(centerX, centerY);
        for (let i=0;i<params.dim;i++) {
            ctx.lineTo(xs[i],ys[i]);
        }
        ctx.stroke();
    }

    if (params.runAnim) requestAnimationFrame(animate);
}

    </script>
</body>
</html> 
